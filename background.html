<html>
<head>
    <script type="text/javascript">

        var tabs = [];

        function updateBadgeText(val) {
            chrome.browserAction.setBadgeText({text:val + ""});
        }

        function init() {
            chrome.browserAction.setBadgeBackgroundColor({color:[32, 7, 114, 255]});
            updateBadgeText(0);

            // count all the open tabs for all the windows
            chrome.windows.getAll({populate:true}, function (windows) {
                for(var i = 0 ; i < windows.length ; i++) {
                    tabs = tabs.concat(windows[i].tabs);
                    updateBadgeText(tabs.length);
                }
            });


            // attach an event handler to capture tabs as they are closed
            chrome.tabs.onRemoved.addListener(function(tab) {
                //  alert('tabs.onRemove --'
                //              + ' window: ' + tab.windowId
                //              + ' tab: '    + tab.id
                //              + ' index: '  + tab.index
                //              + ' url: '    + tab.url);
                tabs.pop();
                updateBadgeText(tabs.length);
            });

            // attach an event handler to capture tabs as they are opened
            chrome.tabs.onCreated.addListener(function(tab) {
                //  alert('tabs.onCreated --'
                //              + ' window: ' + tab.windowId
                //              + ' tab: '    + tab.id
                //              + ' index: '  + tab.index
                //              + ' url: '    + tab.url);
                tabs.unshift(tab);
                updateBadgeText(tabs.length);
            });
        }
        
    </script>
</head>
<body onload="init()">
</body>
</html>