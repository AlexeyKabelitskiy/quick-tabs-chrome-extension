<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="assets/styles.css" type="text/css" media="all"/>
    <script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="js/jquery.quicksearch.js"></script>
    <script type="text/javascript">

        function tabImage(tab) {
            if(tab.favIconUrl != null && tab.favIconUrl.length > 0) {
                return tab.favIconUrl;
            } else {
                return "/assets/blank.png"
            }
        }

        function switchTabs(tabid) {
            chrome.tabs.get(tabid, function(tab) {
                chrome.windows.getCurrent(function(w) {
                    var wid = /\d*$/.exec(window.location.href)[0];
                    if(!wid) {
                        wid = w.id;
                    } else {
                        wid = parseInt(wid);
                    }
                    if(wid != tab.windowId) {
                        chrome.tabs.move(tab.id, {windowId:wid, index:1000}, function(t2) {
                            chrome.tabs.update(tab.id, {selected:true});
                            tab.windowId = t2.windowId;
                            window.close();
                        });
                    } else {
                        chrome.tabs.update(tab.id, {selected:true});
                        window.close();
                    }
                });
            });
        }

        function init() {

            // find the available tabs
            var tabs = chrome.extension.getBackgroundPage().tabs;

            // draw the current tabs
            $("#template").text("");
            $.each(tabs, function(i, tab) {
                $("#template").append($("<tr></tr>")
                        .attr({class:"tab", id:tab.id, window:tab.windowId})
                        .append("<td></td>").append($("<img></img>").attr({class:"tabimage", src:tabImage(tab), width:"16", height:"16", border:"0"}))
                        .append("<td></td>").append($("<div class='title'></div>").text(tab.title)).append($("<div class='url'></div>").text(tab.url))
                        .click(function() {
                    switchTabs(tab.id);
                }).mouseover(function () {
                    $("tr.withfocus").removeClass('withfocus');
                    $(this).addClass('withfocus');
                }));
            });

            $("tr:visible:first").addClass("withfocus");

            $('table#template tr').quicksearch({
                position: 'before',
                attached: 'table#template',
                focusOnLoad: true,
                loaderText: '',
                labelText: '',
                fixWidths: true,
                stripeRowClass: ['odd', 'even'],
                delay:100,
                onAfter: function() {
                    $("tr.withfocus").removeClass("withfocus");
                    $("tr:visible:first").addClass("withfocus");
                }
            });

            $(document).keyup(function(event) {
                switch (event.keyCode) {
                    case 13:
                        // 13 = enter
                        tabid = parseInt($("tr.withfocus").attr("id"));
                        switchTabs(tabid);
                        break;
                    case 27:
                        // 27 = esc
                        window.close();
                        break;
                    case 38:
                        // 38 = arrow up
                        $("tr.withfocus").removeClass('withfocus').prev(":visible").addClass('withfocus');
                        if ($("tr.withfocus:visible").length == 0) {
                            $("tr:visible:first").addClass("withfocus");
                        }
                        break;
                    case 40:
                        // 40 = arrow down
                        $("tr.withfocus").removeClass('withfocus').next(":visible").addClass('withfocus');
                        if ($("tr.withfocus:visible").length == 0) {
                            $("tr:visible:last").addClass("withfocus");
                        }
                        break;
                }

            });
        }
    </script>
    <title>Quick Tabs</title>
</head>
<body onload="init()" onBlur="window.close()">
<table id="template" border="0" cellpadding="0" cellspacing="0">
    <tr class="tab odd withfocus">
        <td><img class="tabimage" src="assets/icon-32.png" alt="image" height="16" width="16"></td>
        <td>
            <div class="title">In this post I will show you how to use LINQ to XML to query the Delicious API</div>
            <div class="url">http://encosia.com/2008/10/31/use-jquery-and-quicksearch-to-interactively-search-any-data/</div>
        </td>
    </tr>
    <tr class="tab even">
        <td><img class="tabimage" src="assets/icon-32.png" alt="image" height="16" width="16"></td>
        <td>
            <div class="title">In this post I will show you how to use LINQ to XML to query the Delicious API</div>
            <div class="url">http://encosia.com/2008/10/31/use-jquery-and-quicksearch-to-interactively-search-any-data/</div>
        </td>
    </tr>
    <tr class="tab odd">
        <td><img class="tabimage" src="assets/icon-32.png" alt="image" height="16" width="16"></td>
        <td>
            <div class="title">In this post I will show you how to use LINQ to XML to query the Delicious API</div>
            <div class="url">http://encosia.com/2008/10/31/use-jquery-and-quicksearch-to-interactively-search-any-data/</div>
        </td>
    </tr>
</table>
</body>
</html>